import React, { useState, useEffect, useRef } from 'react';
import { 
  ArrowDown, CheckCircle, FileText, Mail, Shield, ChevronRight, 
  Brain, Zap, GitMerge, RefreshCw, Layers, Database, Network, Activity,
  MessageSquare, Sliders, TrendingUp, Terminal
} from 'lucide-react';

// --- STYLES & ANIMATIONS ---
const styles = `
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap');
  
  :root {
    --bg-dark: #1E1F2B;
    --bg-light: #F2F2F2;
    --text-main: #111827;
    --accent-indigo: #9881F3;  /* Intelligence */
    --accent-cyan: #13C9BA;    /* Culture */
    --accent-emerald: #34D399; /* Learning */
  }

  body {
    font-family: 'Inter', sans-serif;
    overflow-x: hidden;
    background-color: var(--bg-dark);
  }

  /* Typography */
  .font-mono { font-family: 'JetBrains Mono', monospace; }

  /* Utilities */
  .text-product-gradient {
    background: linear-gradient(93deg, #9881F3 0%, #13C9BA 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  
  .bg-gradient-highlight {
    background: linear-gradient(135deg, rgba(152, 129, 243, 0.1) 0%, rgba(19, 201, 186, 0.1) 100%);
    backdrop-filter: blur(10px);
  }

  .glass-panel {
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.05);
  }

  /* Animations */
  .fade-in-up {
    animation: fadeInUp 0.8s cubic-bezier(0.2, 0.65, 0.3, 0.9) forwards;
    opacity: 0;
    transform: translateY(30px);
  }
  
  .delay-100 { animation-delay: 0.1s; }
  .delay-200 { animation-delay: 0.2s; }
  .delay-300 { animation-delay: 0.3s; }
  .delay-400 { animation-delay: 0.4s; }
  .delay-500 { animation-delay: 0.5s; }

  @keyframes fadeInUp {
    to { opacity: 1; transform: translateY(0); }
  }

  .animate-bounce-slow {
    animation: bounceSlow 2s infinite;
  }

  @keyframes bounceSlow {
    0%, 100% { transform: translateY(-15%); }
    50% { transform: translateY(0); }
  }

  /* --- NEURAL CORE ANIMATIONS --- */
  .orbit {
    position: absolute;
    top: 50%;
    left: 50%;
    border-radius: 50%;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transform-style: preserve-3d;
  }

  .orbit-indigo {
    width: 320px;
    height: 320px;
    margin-top: -160px;
    margin-left: -160px;
    animation: spin-orbit 14s linear infinite;
    border-color: rgba(152, 129, 243, 0.2);
    box-shadow: 0 0 20px rgba(152, 129, 243, 0.05);
  }

  .orbit-cyan {
    width: 250px;
    height: 250px;
    margin-top: -125px;
    margin-left: -125px;
    animation: spin-orbit-reverse 10s linear infinite;
    border-color: rgba(19, 201, 186, 0.2);
    box-shadow: 0 0 20px rgba(19, 201, 186, 0.05);
  }

  .orbit-emerald {
    width: 180px;
    height: 180px;
    margin-top: -90px;
    margin-left: -90px;
    animation: spin-orbit 8s linear infinite;
    border-color: rgba(52, 211, 153, 0.2);
    box-shadow: 0 0 20px rgba(52, 211, 153, 0.05);
  }

  .planet {
    position: absolute;
    top: 50%;
    left: 0;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-top: -5px;
    margin-left: -5px;
    box-shadow: 0 0 12px currentColor;
    background-color: currentColor;
  }

  @keyframes spin-orbit {
    0% { transform: rotateZ(0deg) rotateX(65deg) rotateY(15deg); }
    100% { transform: rotateZ(360deg) rotateX(65deg) rotateY(15deg); }
  }

  @keyframes spin-orbit-reverse {
    0% { transform: rotateZ(360deg) rotateX(-65deg) rotateY(-15deg); }
    100% { transform: rotateZ(0deg) rotateX(-65deg) rotateY(-15deg); }
  }

  .core-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100px;
    height: 100px;
    background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
    filter: blur(20px);
    z-index: 10;
    animation: pulse-core 4s ease-in-out infinite;
  }

  @keyframes pulse-core {
    0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(0.9); }
    50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.1); }
  }
  
  /* Log Typing Effect */
  .typing-cursor::after {
    content: '_';
    animation: blink 1s step-end infinite;
  }
  @keyframes blink { 50% { opacity: 0; } }
`;

// --- HOOKS ---

// Hook for scroll-triggered animations
const useScrollAnimation = () => {
  const ref = useRef(null);
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsVisible(true);
          observer.disconnect(); // Only animate once
        }
      },
      { threshold: 0.2 } 
    );
    if (ref.current) observer.observe(ref.current);
    return () => observer.disconnect();
  }, []);

  return [ref, isVisible];
};

// Hook for counting up numbers
const useCountUp = (end, duration = 2000, startAnimation) => {
  const [count, setCount] = useState(0);

  useEffect(() => {
    if (!startAnimation) return;

    let startTime;
    let animationFrame;

    const animate = (timestamp) => {
      if (!startTime) startTime = timestamp;
      const progress = timestamp - startTime;
      const percentage = Math.min(progress / duration, 1);
      
      // Easing function (easeOutExpo)
      const ease = (x) => x === 1 ? 1 : 1 - Math.pow(2, -10 * x);
      
      setCount(Math.floor(ease(percentage) * end));

      if (progress < duration) {
        animationFrame = requestAnimationFrame(animate);
      } else {
        setCount(end);
      }
    };

    animationFrame = requestAnimationFrame(animate);
    return () => cancelAnimationFrame(animationFrame);
  }, [end, duration, startAnimation]);

  return count;
};

// --- COMPONENTS ---

const HeroSection = ({ title, metadata }) => {
  return (
    <div className="relative h-screen w-full overflow-hidden bg-[#1E1F2B] text-white">
      {/* Dynamic Background */}
      <div className="absolute inset-0 z-0">
         <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"></div>
         <div className="absolute inset-0 bg-gradient-to-b from-[#1E1F2B] via-transparent to-[#1E1F2B]"></div>
         
         {/* Placeholder for Video */}
         <video 
          autoPlay 
          muted 
          loop 
          playsInline 
          className="w-full h-full object-cover opacity-40 mix-blend-screen"
        >
          <source src="https://assets.mixkit.co/videos/preview/mixkit-network-of-connected-dots-and-lines-26462-large.mp4" type="video/mp4" />
        </video>
      </div>

      <div className="relative z-10 h-full max-w-[1600px] mx-auto px-6 md:px-12 flex flex-col justify-end pb-24">
        <div className="flex flex-col md:flex-row justify-between items-end gap-8">
          <div className="animate-[fadeInUp_1.2s_cubic-bezier(0.2,0.8,0.2,1)]">
            <h1 className="text-6xl md:text-8xl lg:text-[9.5rem] font-bold tracking-tighter leading-[0.85] mb-8 text-white mix-blend-normal">
              {title}
            </h1>
            <div className="flex items-center gap-4">
               <div className="h-1 w-24 bg-gradient-to-r from-[#9881F3] to-[#13C9BA] shadow-[0_0_20px_rgba(152,129,243,0.6)] rounded-full"></div>
               <span className="text-sm font-mono text-[#9881F3] tracking-widest opacity-80">SYSTEM_ONLINE_V2.4</span>
            </div>
          </div>

          <div className="hidden md:flex flex-col items-end border-l border-white/10 pl-8 py-2 gap-4 animate-[fadeInUp_1.4s_cubic-bezier(0.2,0.8,0.2,1)]">
            {metadata.map((item, idx) => (
              <div key={idx} className="group flex items-center gap-3 cursor-default">
                <span className="text-[10px] uppercase tracking-[0.3em] font-medium text-white/40 group-hover:text-[#13C9BA] transition-colors duration-300">
                  {item}
                </span>
                <div className="w-1.5 h-1.5 rounded-full bg-white/20 group-hover:bg-[#13C9BA] group-hover:shadow-[0_0_10px_#13C9BA] transition-all duration-300"></div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

const NarrativeTrack = ({ stage1, stage2, description }) => {
  const containerRef = useRef(null);
  const [progress, setProgress] = useState(0);

  useEffect(() => {
    const handleScroll = () => {
      if (!containerRef.current) return;
      const rect = containerRef.current.getBoundingClientRect();
      const windowHeight = window.innerHeight;
      const totalDist = rect.height - windowHeight;
      const scrolled = -rect.top;
      let p = scrolled / totalDist;
      p = Math.max(0, Math.min(1, p));
      setProgress(p);
    };
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const stage1Opacity = progress < 0.35 ? Math.min(1, progress * 4) : Math.max(0, 1 - (progress - 0.35) * 5);
  const stage2Opacity = progress > 0.3 ? Math.min(1, (progress - 0.3) * 3) : 0;
  const stage2Y = (1 - stage2Opacity) * 60;

  return (
    <section 
      ref={containerRef}
      className="relative h-[250vh] bg-[#1E1F2B]"
    >
      <div className="sticky top-0 h-screen flex items-center justify-center overflow-hidden">
        <div 
          className="absolute w-[800px] h-[800px] bg-[#9881F3] rounded-full blur-[120px] opacity-[0.05] pointer-events-none transition-transform duration-100 ease-out"
          style={{ transform: `translate(${Math.sin(progress * 5) * 100}px, ${Math.cos(progress * 5) * 100}px)` }}
        ></div>

        <div className="max-w-6xl mx-auto px-6 text-center z-10 flex flex-col items-center">
          
          <h2 
            className="absolute text-4xl md:text-6xl lg:text-7xl font-light tracking-tight text-white transition-all duration-300"
            style={{ 
              opacity: stage1Opacity, 
              filter: `blur(${(1-stage1Opacity)*15}px)`,
              transform: `scale(${0.95 + (stage1Opacity * 0.05)})` 
            }}
          >
            {stage1}
          </h2>

          <div 
            className="relative z-10 transition-transform duration-700 ease-out"
            style={{ opacity: stage2Opacity, transform: `translateY(${stage2Y}px)` }}
          >
            <h2 className="text-5xl md:text-8xl lg:text-9xl font-semibold tracking-tighter leading-tight text-white mix-blend-overlay opacity-90">
              {stage2}
            </h2>
            
            <div 
              className="mt-16 max-w-xl mx-auto transition-all duration-1000 delay-100"
              style={{ opacity: stage2Opacity > 0.8 ? 1 : 0, transform: `translateY(${stage2Opacity > 0.8 ? 0 : 40}px)` }}
            >
              <p className="text-lg md:text-2xl leading-relaxed font-light text-white/60">
                {description}
              </p>
              
              <div className="mt-20 flex flex-col items-center animate-bounce-slow opacity-40">
                <div className="w-px h-16 bg-gradient-to-b from-transparent via-white to-transparent mb-4"></div>
                <span className="text-[10px] uppercase tracking-[0.25em] text-white">Scroll to Analyze</span>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>
  );
};

const KnowledgeDeepDive = () => {
  const [ref, isVisible] = useScrollAnimation();
  const [activeFeature, setActiveFeature] = useState(0);

  const features = [
    {
      id: "intelligence",
      color: "#9881F3",
      icon: <Database size={24} />,
      title: "Domain Intelligence",
      subtitle: "isBIM Engineering Data",
      desc: "Ingests 10 years of project archives. It understands 'rebar' as a structural dependency, not just a keyword."
    },
    {
      id: "culture",
      color: "#13C9BA",
      icon: <Network size={24} />,
      title: "Cultural Adaptation",
      subtitle: "Context Tuning",
      desc: "Fine-tuned on internal comms. Learns that 'urgent' means 2 hours for team, 24 hours for vendors."
    },
    {
      id: "learning",
      color: "#34D399",
      icon: <Activity size={24} />,
      title: "Continuous Learning",
      subtitle: "RLHF Feedback Loops",
      desc: "Every edit rewrites neural weights. It learns from mistakes to never repeat them."
    }
  ];

  return (
    <section className="py-32 px-6 md:px-12 bg-[#1E1F2B] text-white overflow-hidden relative border-t border-white/5">
      <div ref={ref} className="max-w-[1400px] mx-auto relative z-10">
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-20 items-center">
          
          <div className={`transition-all duration-1000 ${isVisible ? 'opacity-100 translate-x-0' : 'opacity-0 -translate-x-20'}`}>
            <div className="flex items-center gap-3 mb-8">
              <span className="w-2 h-2 rounded-full bg-[#9881F3] animate-pulse"></span>
              <span className="text-xs font-mono text-[#9881F3] uppercase tracking-widest">System Architecture</span>
            </div>
            
            <h2 className="text-4xl md:text-6xl font-light tracking-tight mb-8 leading-tight">
              The Knowledge Agent <br/>
              <span className="font-semibold bg-clip-text text-transparent bg-gradient-to-r from-white to-white/40">Deep Dive</span>
            </h2>

            <div className="space-y-4">
              {features.map((item, idx) => (
                <div 
                  key={idx}
                  className={`group relative cursor-pointer p-8 rounded-2xl transition-all duration-500 border overflow-hidden ${activeFeature === idx ? 'bg-white/5 border-white/10 shadow-2xl' : 'bg-transparent border-transparent hover:bg-white/[0.02]'}`}
                  onClick={() => setActiveFeature(idx)}
                  onMouseEnter={() => setActiveFeature(idx)}
                >
                  <div 
                    className="absolute inset-0 transition-opacity duration-500 pointer-events-none opacity-0 group-hover:opacity-100" 
                    style={{ background: `linear-gradient(90deg, ${item.color}11, transparent)` }}
                  />
                  
                  <div className="flex items-start gap-6 relative z-10">
                    <div 
                      className={`w-12 h-12 rounded-xl flex items-center justify-center transition-all duration-500 shadow-lg shrink-0 border border-white/10`}
                      style={{ 
                        backgroundColor: activeFeature === idx ? item.color : 'rgba(255,255,255,0.03)',
                        color: activeFeature === idx ? '#fff' : 'rgba(255,255,255,0.3)',
                        transform: activeFeature === idx ? 'scale(1.1)' : 'scale(1)'
                      }}
                    >
                      {item.icon}
                    </div>
                    <div>
                      <h3 className={`text-xl font-medium mb-1 transition-colors duration-300 ${activeFeature === idx ? 'text-white' : 'text-white/40'}`}>
                        {item.title}
                      </h3>
                      <div className="text-xs font-mono uppercase tracking-widest mb-3 opacity-60" style={{ color: activeFeature === idx ? item.color : 'gray' }}>
                        {item.subtitle}
                      </div>
                      <p className={`text-sm leading-relaxed transition-all duration-500 ${activeFeature === idx ? 'text-white/70 max-h-24 opacity-100' : 'text-white/20 max-h-0 opacity-0'}`}>
                        {item.desc}
                      </p>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          <div className={`relative h-[600px] flex items-center justify-center transition-all duration-1000 delay-300 ${isVisible ? 'opacity-100 scale-100' : 'opacity-0 scale-90'}`}>
            
            <div className="absolute inset-0 bg-gradient-radial from-[#9881F3]/20 to-transparent opacity-40 blur-[80px]"></div>

            <div className="relative w-[500px] h-[500px] preserve-3d">
              <div className="core-glow"></div>
              
              <div className={`orbit orbit-indigo transition-all duration-1000 ${activeFeature === 0 ? 'opacity-100 scale-105 border-opacity-50' : 'opacity-30 scale-100'}`}>
                <div className="planet" style={{ color: features[0].color }}></div>
              </div>

              <div className={`orbit orbit-cyan transition-all duration-1000 ${activeFeature === 1 ? 'opacity-100 scale-105 border-opacity-50' : 'opacity-30 scale-100'}`}>
                <div className="planet" style={{ color: features[1].color }}></div>
              </div>

              <div className={`orbit orbit-emerald transition-all duration-1000 ${activeFeature === 2 ? 'opacity-100 scale-105 border-opacity-50' : 'opacity-30 scale-100'}`}>
                <div className="planet" style={{ color: features[2].color }}></div>
              </div>

              <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 bg-[#1E1F2B] p-6 rounded-full border border-white/10 shadow-2xl">
                 <Brain size={64} className="text-white opacity-90" />
              </div>
            </div>

            <div className="absolute bottom-10 right-0 font-mono text-[10px] text-white/20 text-right space-y-1">
              <div>// CONNECTED_NODES: 8,421</div>
              <div>// LATENCY: 12ms</div>
              <div className="text-[#34D399]">STATUS: OPTIMIZED</div>
            </div>

          </div>

        </div>
      </div>
    </section>
  );
};

// FeatureRow Updated for Zig-Zag Layout
const FeatureRow = ({ feature, index, total }) => {
  const [ref, isVisible] = useScrollAnimation();
  const [activeTab, setActiveTab] = useState('agent');
  const [logStep, setLogStep] = useState(0);
  
  // Calculate if the current index is even (for zig-zag effect)
  const isEven = index % 2 === 0;

  useEffect(() => {
    if (activeTab === 'agent' && isVisible) {
      setLogStep(0);
      const interval = setInterval(() => {
        setLogStep(prev => {
          if (prev >= feature.logs.length) {
            clearInterval(interval);
            return prev;
          }
          return prev + 1;
        });
      }, 800);
      return () => clearInterval(interval);
    }
  }, [activeTab, isVisible, feature.logs.length]);

  return (
    <div ref={ref} className="min-h-screen flex items-center py-24 border-b border-gray-300 last:border-0">
      <div className="w-full max-w-[1600px] mx-auto px-6 md:px-12 grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-24 items-center">
        
        {/* Text Column - Sticky Info */}
        <div className={`lg:col-span-5 relative transition-all duration-1000 
          ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-20'}
          ${isEven ? 'lg:order-2' : 'lg:order-1'}
        `}>
          <div className="sticky top-32">
            <div className="flex items-center gap-4 text-gray-400 mb-8 font-mono text-xs tracking-wider">
              <span className="text-gray-900 font-bold">0{index}</span>
              <div className={`h-px bg-gray-300 flex-grow transition-all duration-1000 origin-left ${isVisible ? 'scale-x-100' : 'scale-x-0'}`}></div>
              <span>0{total}</span>
            </div>
            
            <h3 className="text-4xl md:text-5xl font-medium text-gray-900 mb-6 leading-tight">
              {feature.title}
            </h3>
            
            <p className="text-lg text-gray-600 leading-relaxed mb-10 font-light">
              {feature.description}
            </p>

            <div className="inline-flex bg-gray-100 rounded-lg p-1 relative">
              <div 
                className="absolute top-1 bottom-1 w-[50%] bg-white rounded-md shadow-sm transition-all duration-300 ease-out"
                style={{ left: activeTab === 'agent' ? '4px' : 'calc(50% - 4px)' }}
              ></div>
              <button 
                onClick={() => setActiveTab('agent')}
                className={`relative z-10 px-8 py-3 text-xs font-bold tracking-widest uppercase transition-colors duration-300 ${activeTab === 'agent' ? 'text-gray-900' : 'text-gray-400'}`}
              >
                Agent View
              </button>
              <button 
                onClick={() => setActiveTab('outcome')}
                className={`relative z-10 px-8 py-3 text-xs font-bold tracking-widest uppercase transition-colors duration-300 ${activeTab === 'outcome' ? 'text-gray-900' : 'text-gray-400'}`}
              >
                Outcome
              </button>
            </div>
          </div>
        </div>

        {/* HUD Card Column */}
        <div className={`lg:col-span-7 transition-all duration-1000 delay-200 
          ${isVisible ? 'opacity-100 translate-x-0' : `opacity-0 ${isEven ? '-translate-x-20' : 'translate-x-20'}`}
          ${isEven ? 'lg:order-1' : 'lg:order-2'}
        `}>
          <div className="bg-[#0f1115] rounded-xl shadow-2xl overflow-hidden border border-gray-800 h-[640px] relative">
            
            <div className="h-12 bg-[#1a1c23] border-b border-gray-800 flex items-center px-4 justify-between">
              <div className="flex gap-2">
                <div className="w-3 h-3 rounded-full bg-red-500/20 border border-red-500/50"></div>
                <div className="w-3 h-3 rounded-full bg-yellow-500/20 border border-yellow-500/50"></div>
                <div className="w-3 h-3 rounded-full bg-green-500/20 border border-green-500/50"></div>
              </div>
              <div className="text-[10px] font-mono text-gray-500 flex items-center gap-2">
                <Shield size={10} />
                SECURE_CONNECTION
              </div>
            </div>

            <div className={`absolute inset-x-0 top-12 bottom-0 p-8 transition-all duration-500 ${activeTab === 'agent' ? 'opacity-100 z-10' : 'opacity-0 z-0'}`}>
               <div className="font-mono text-sm h-full flex flex-col">
                 <div className="flex items-center gap-3 mb-8 pb-4 border-b border-gray-800/50">
                    <div className="p-2 bg-[#9881F3]/10 rounded text-[#9881F3]">
                      <Terminal size={18} />
                    </div>
                    <div>
                      <div className="text-gray-200 font-bold">JARVIS_CORE_V2</div>
                      <div className="text-xs text-gray-500">Listening to input stream...</div>
                    </div>
                    <div className="ml-auto flex items-center gap-2 text-[#34D399] text-xs">
                      <span className="w-2 h-2 bg-[#34D399] rounded-full animate-pulse"></span>
                      ACTIVE
                    </div>
                 </div>

                 <div className="space-y-4 overflow-hidden">
                    {feature.logs.map((log, i) => (
                      <div 
                        key={i} 
                        className={`transition-all duration-500 border-l-2 pl-4 py-1 ${i < logStep ? 'opacity-100 translate-x-0' : 'opacity-0 -translate-x-4'}`}
                        style={{ borderColor: log.type === 'action' ? '#9881F3' : '#333' }}
                      >
                        <div className="flex justify-between text-[10px] text-gray-600 mb-1 font-bold">
                           <span>{log.time}</span>
                           <span className="uppercase">{log.type}</span>
                        </div>
                        <div className={`text-sm ${log.type === 'action' ? 'text-gray-200' : 'text-gray-400'}`}>
                          <span className="mr-2 text-gray-600">$</span>
                          {log.text}
                        </div>
                      </div>
                    ))}
                    {logStep >= feature.logs.length && (
                      <div className="pl-4 text-[#9881F3] animate-pulse pt-2 text-xs">
                        Awaiting next command<span className="typing-cursor"></span>
                      </div>
                    )}
                 </div>
               </div>
            </div>

            <div className={`absolute inset-x-0 top-12 bottom-0 bg-white transition-all duration-500 flex items-center justify-center text-center p-12 ${activeTab === 'outcome' ? 'opacity-100 z-10' : 'opacity-0 z-0'}`}>
               <div className="max-w-md animate-[fadeInUp_0.5s_ease-out]">
                 <div className="w-24 h-24 bg-gradient-to-tr from-[#13C9BA] to-emerald-400 rounded-full flex items-center justify-center mx-auto mb-8 shadow-xl shadow-emerald-200">
                   <CheckCircle size={48} className="text-white" />
                 </div>
                 <h4 className="text-4xl font-bold text-gray-900 mb-6 tracking-tight">{feature.outcomeTitle}</h4>
                 <div className="w-12 h-1 bg-gray-200 mx-auto mb-6 rounded-full"></div>
                 <p className="text-gray-500 text-xl font-light leading-relaxed">{feature.outcomeDesc}</p>
               </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  );
};

const FeatureSection = ({ features }) => {
  return (
    <div className="bg-[#F2F2F2] py-20">
      {features.map((feature, idx) => (
        <FeatureRow key={idx} feature={feature} index={idx + 1} total={features.length} />
      ))}
    </div>
  );
};

// --- UPDATED EvolutionSection (More Compact & Condensed) ---
const EvolutionSection = () => {
  const [ref, isVisible] = useScrollAnimation();
  
  const adminSaved = useCountUp(80, 2500, isVisible);
  const decisionSpeed = useCountUp(3, 2000, isVisible);

  return (
    <section className="py-20 px-6 md:px-12 bg-[#1E1F2B] text-white relative overflow-hidden">
      {/* Background Decor */}
      <div className="absolute top-0 right-0 w-[800px] h-[800px] bg-[#13C9BA] opacity-[0.03] blur-[150px] rounded-full pointer-events-none"></div>

      <div ref={ref} className="max-w-[1200px] mx-auto relative z-10">
        
        {/* Header (Condensed) */}
        <div className={`max-w-3xl mx-auto text-center lg:text-left mb-12 transition-all duration-1000 ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-20'}`}>
          <h2 className="text-4xl md:text-5xl font-bold text-white mb-2 leading-tight">
            Train, Interact, Evolve.
          </h2>
          <p className="text-lg text-white/50 leading-relaxed max-w-2xl mx-auto lg:mx-0">
            Feedback loops refine accuracy to your corporate DNA.
          </p>
        </div>

        {/* Timeline Layout (Compact) */}
        <div className="relative mb-12">
          
          {/* Desktop Timeline Track (Horizontal) */}
          <div className="hidden md:block absolute top-[52px] left-0 w-full h-px bg-gradient-to-r from-white/10 via-white/20 to-transparent z-0"></div>
          {/* Mobile Timeline Track (Vertical) */}
          <div className="md:hidden absolute left-8 top-0 h-full w-px bg-gradient-to-b from-white/10 via-white/20 to-transparent z-0"></div>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 relative z-10">
            
            {/* Step 1 */}
            <div className={`relative transition-all duration-700 delay-100 ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-20'}`}>
              {/* Timeline Node */}
              <div className="hidden md:flex absolute -top-[23px] left-0 w-full justify-start">
                 <div className="w-12 h-12 rounded-full bg-[#1E1F2B] border border-white/20 flex items-center justify-center relative z-20 text-white/50 font-mono text-sm">01</div>
              </div>
              <div className="md:hidden absolute left-2 top-0 w-12 h-12 rounded-full bg-[#1E1F2B] border border-white/20 flex items-center justify-center relative z-20 text-white/50 font-mono text-sm">01</div>

              <div className="md:pt-12 pl-20 md:pl-0">
                 <div className={`glass-panel p-6 rounded-2xl relative overflow-hidden group hover:border-[#9881F3]/50 transition-colors duration-300`}>
                    <h3 className="text-xl font-bold text-white mb-2">Interaction</h3>
                    <p className="text-white/50 text-sm leading-relaxed mb-4">
                        Records context from daily actions.
                    </p>
                    {/* Visual Connector Arrow */}
                    <div className="hidden md:flex justify-end text-white/20 group-hover:translate-x-2 transition-transform duration-300">
                        <ChevronRight size={20} />
                    </div>
                 </div>
              </div>
            </div>

            {/* Step 2 */}
            <div className={`relative transition-all duration-700 delay-300 ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-20'}`}>
              {/* Timeline Node */}
              <div className="hidden md:flex absolute -top-[23px] left-0 w-full justify-start">
                 <div className="w-12 h-12 rounded-full bg-[#1E1F2B] border border-[#9881F3]/50 flex items-center justify-center relative z-20 text-[#9881F3] font-mono text-sm shadow-[0_0_15px_rgba(152,129,243,0.3)]">02</div>
              </div>
              <div className="md:hidden absolute left-2 top-0 w-12 h-12 rounded-full bg-[#1E1F2B] border border-[#9881F3]/50 flex items-center justify-center relative z-20 text-[#9881F3] font-mono text-sm shadow-[0_0_15px_rgba(152,129,243,0.3)]">02</div>

              <div className="md:pt-12 pl-20 md:pl-0">
                 <div className={`glass-panel p-6 rounded-2xl relative overflow-hidden group hover:border-[#13C9BA]/50 transition-colors duration-300`}>
                    <h3 className="text-xl font-bold text-white mb-2">Feedback Loop</h3>
                    <p className="text-white/50 text-sm leading-relaxed mb-4">
                        Refines weights overnight.
                    </p>
                    {/* Visual Connector Arrow */}
                    <div className="hidden md:flex justify-end text-white/20 group-hover:translate-x-2 transition-transform duration-300">
                        <ChevronRight size={20} />
                    </div>
                 </div>
              </div>
            </div>

            {/* Step 3 */}
            <div className={`relative transition-all duration-700 delay-500 ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-20'}`}>
              {/* Timeline Node */}
              <div className="hidden md:flex absolute -top-[23px] left-0 w-full justify-start">
                 <div className="w-12 h-12 rounded-full bg-gradient-to-br from-[#9881F3] to-[#13C9BA] flex items-center justify-center relative z-20 text-white font-mono text-sm shadow-[0_0_20px_rgba(19,201,186,0.5)]">03</div>
              </div>
              <div className="md:hidden absolute left-2 top-0 w-12 h-12 rounded-full bg-gradient-to-br from-[#9881F3] to-[#13C9BA] flex items-center justify-center relative z-20 text-white font-mono text-sm shadow-[0_0_20px_rgba(19,201,186,0.5)]">03</div>

              <div className="md:pt-12 pl-20 md:pl-0">
                 <div className={`relative bg-gradient-highlight p-6 rounded-2xl border border-[#9881F3]/40 shadow-[0_0_50px_rgba(152,129,243,0.1)] overflow-hidden group hover:scale-[1.02] transition-transform`}>
                    <div className="absolute inset-0 bg-gradient-to-br from-[#9881F3]/10 to-[#13C9BA]/10 opacity-50"></div>
                    <div className="relative z-10">
                        <h3 className="text-xl font-bold text-white mb-2">Evolution</h3>
                        <p className="text-white/80 text-sm leading-relaxed">
                            Anticipates needs & scales logic.
                        </p>
                    </div>
                 </div>
              </div>
            </div>

          </div>
        </div>

        {/* The Result Card (Condensed) */}
        <div className={`glass-panel rounded-3xl p-8 flex flex-col md:flex-row items-center justify-between gap-8 ${isVisible ? 'fade-in-up delay-500' : 'opacity-0'}`}>
             <div className="text-center md:text-left max-w-sm">
                 <h3 className="text-2xl font-bold text-white">The Result?</h3>
             </div>

             <div className="flex flex-col sm:flex-row gap-8 md:gap-16 items-center">
                 <div className="text-center">
                      <div className="flex items-baseline justify-center gap-1">
                         <span className="text-5xl font-bold text-white tracking-tighter">{adminSaved}</span>
                         <span className="text-2xl font-light text-[#9881F3]">%</span>
                      </div>
                      <div className="text-[10px] font-mono uppercase tracking-widest text-white/40 mt-1">Less Admin Overhead</div>
                 </div>
                 
                 {/* Divider */}
                 <div className="hidden sm:block w-px h-12 bg-white/10"></div>

                 <div className="text-center">
                      <div className="flex items-baseline justify-center gap-1">
                         <span className="text-5xl font-bold text-white tracking-tighter">{decisionSpeed}</span>
                         <span className="text-2xl font-light text-[#13C9BA]">x</span>
                      </div>
                      <div className="text-[10px] font-mono uppercase tracking-widest text-white/40 mt-1">Faster Decisions</div>
                 </div>
             </div>
        </div>

      </div>
    </section>
  );
};

const CTASection = ({ title, subtitle, buttonText }) => {
  const [ref, isVisible] = useScrollAnimation();

  return (
    <section className="relative bg-[#1E1F2B] py-40 overflow-hidden border-t border-white/5">
      <div className="absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[500px] bg-[#9881F3] opacity-10 blur-[120px] rounded-full pointer-events-none"></div>
      
      <div ref={ref} className={`relative z-10 max-w-4xl mx-auto px-6 text-center transition-all duration-1000 ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-20'}`}>
        <h2 className="text-5xl md:text-7xl font-light text-white mb-8 tracking-tight">
          <span className="text-product-gradient">{title}</span>
        </h2>
        <p className="text-xl md:text-2xl text-white/60 font-light mb-16 max-w-2xl mx-auto leading-relaxed">
          {subtitle}
        </p>
        
        <button className="group relative inline-flex items-center gap-4 px-12 py-5 bg-white text-[#1E1F2B] rounded-full font-bold text-sm uppercase tracking-[0.15em] transition-all duration-300 hover:scale-105 hover:shadow-[0_0_50px_rgba(255,255,255,0.2)]">
          {buttonText}
          <ChevronRight size={16} className="transition-transform group-hover:translate-x-1" />
        </button>

        <div className="mt-12 text-white/20 text-xs font-mono">
            COPYRIGHT © 2024 isBIM JARVIS. ALL RIGHTS RESERVED.
        </div>
      </div>
    </section>
  );
};

export default function JarvisLandingPage() {
  const metadata = ["Construction Brain", "Corporate Copilot", "Adaptive AI"];
  
  const features = [
    {
      title: "Email Agent",
      id: "MAIL-01",
      icon: <Mail size={24} />,
      description: "Auto-files documents, extracts data, fills forms, and routes to JARVIS Pay for invoices or VOs. No more lost attachments or manual entry.",
      logs: [
        { time: "10:42:01", type: "system", text: "New thread detected: 'Site B - Concrete VO'" },
        { time: "10:42:05", type: "action", text: "Analyzing attachment: invoice_882.pdf" },
        { time: "10:42:08", type: "system", text: "Extracted: Amount $4,200, Vendor: Ace Concrete" },
        { time: "10:42:12", type: "action", text: "Form filled: PR-2024-882. Routing to Finance." },
      ],
      outcomeTitle: "Zero Inbox. Zero Admin.",
      outcomeDesc: "Documents filed and forms filled automatically. Your team never misses a variation order again."
    },
    {
      title: "Compliance Agent",
      id: "COMP-02",
      icon: <Shield size={24} />,
      description: "Ask anytime — “Is this rebar schedule compliant?” — and get instant, contract- and law-aligned answers with audit trails.",
      logs: [
        { time: "14:15:22", type: "system", text: "Query: 'Check rebar schedule vs BS 8666'" },
        { time: "14:15:25", type: "action", text: "Scanning: Structural_Spec_v4.pdf" },
        { time: "14:15:30", type: "system", text: "Flag: Shape Code 99 requires special approval." },
        { time: "14:15:32", type: "action", text: "Report generated. Audit trail ID #9921." },
      ],
      outcomeTitle: "Instant Audit Shield",
      outcomeDesc: "Risks flagged before they happen. Full compliance coverage backed by instant references to local laws."
    },
    {
      title: "Tendering Agent",
      id: "TEND-03",
      icon: <FileText size={24} />,
      description: "Digests 500-page tenders into bite-sized intel: scoring matrix, BOQ highlights, and risk flags.",
      logs: [
        { time: "09:00:01", type: "system", text: "Ingesting: Tender_Package_Full.zip (500 pages)" },
        { time: "09:00:45", type: "action", text: "Generating Risk Matrix..." },
        { time: "09:01:12", type: "system", text: "Critical Risk Found: Clause 14.2 (Liquidated Damages)" },
        { time: "09:01:30", type: "action", text: "Scoring Matrix extracted. Scope gaps identified." },
      ],
      outcomeTitle: "Win More Bids",
      outcomeDesc: "Bid strategy based on deep data, not guesswork. Reduce tender review time by 80%."
    }
  ];

  return (
    <div className="antialiased text-gray-900 bg-[#1E1F2B]">
      <style>{styles}</style>
      
      {/* 1. Hero Section */}
      <HeroSection 
        title="JARVIS Agent" 
        metadata={metadata} 
      />

      {/* 2. Scroll Narrative */}
      <NarrativeTrack 
        stage1="Your corporate AI staff" 
        stage2="for construction."
        description="Trained on engineering brain, adapts to your culture, automates the tedious."
      />

      {/* 3. The Knowledge Agent (Deep Dive) */}
      <KnowledgeDeepDive />

      {/* 4. Product Layer (Specialized Agents) */}
      <div className="relative z-10 bg-[#F2F2F2]">
         <div className="pt-24 px-6 md:px-12 text-center fade-in-up">
            <h2 className="text-3xl md:text-5xl font-light mb-4 text-gray-900">Three Specialized Agents</h2>
            <p className="text-gray-400 text-xl font-light">One Unified Brain</p>
         </div>
         <FeatureSection features={features} />
      </div>

      {/* 5. Evolution Summary (UPDATED Phase 5) */}
      <EvolutionSection />

      {/* 6. Call to Action */}
      <CTASection 
        title="Meet your new AI staff"
        subtitle="Request a live Agent session today."
        buttonText="Learn More"
      />
    </div>
  );
}