<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvis AI - Global Intelligence HUD</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --color-sky: 56, 189, 248;
            --color-amber: 251, 191, 36;
            --color-indigo: 129, 140, 248;
            --color-slate: 148, 163, 184;
            --color-emerald: 52, 211, 153;
        }

        body {
            background-color: #020617;
            font-family: 'Inter', sans-serif;
            color: white;
            overflow-x: hidden;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Ambient Animations */
        @keyframes scanline {
            0% { top: -10%; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 110%; opacity: 0; }
        }
        .scan-beam {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
            animation: scanline 3s linear infinite;
        }

        /* Glassmorphism Panel Base */
        .hud-glass {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(148, 163, 184, 0.3);
            box-shadow: 0 0 30px rgba(0,0,0,0.7);
        }

        /* Beam Glow Filter */
        .beam-glow {
            filter: drop-shadow(0 0 6px currentColor);
        }

        /* Custom Transition for Morphing Effect */
        .morph-transition {
            transition-property: width, height, opacity, transform, border-color, background-color;
            transition-duration: 0.5s;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Specific positioning classes for expanding directions */
        .origin-top-center { transform-origin: top center; }
        .origin-bottom-center { transform-origin: bottom center; }
        .origin-center-left { transform-origin: center left; }
        .origin-center-right { transform-origin: center right; }
        
        /* Data Packet Animation */
        .data-packet {
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center relative bg-[#020617]">

    <!-- LAYER 0: Background Grid -->
    <div class="absolute inset-0 z-0 pointer-events-none">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-900/40 via-[#020617] to-[#020617]"></div>
        <!-- Technical Grid -->
        <div class="absolute inset-0 opacity-10" 
             style="background-image: linear-gradient(#334155 1px, transparent 1px), linear-gradient(to right, #334155 1px, transparent 1px); background-size: 60px 60px;">
        </div>
        <!-- Large Background Rings -->
        <div class="absolute inset-0 flex items-center justify-center opacity-10 pointer-events-none">
            <div class="w-[800px] h-[800px] border border-slate-700 rounded-full"></div>
            <div class="w-[1400px] h-[1400px] border border-slate-800 rounded-full border-dashed"></div>
        </div>
    </div>

    <!-- LAYER 1: Main Content -->
    <div class="relative z-10 w-full max-w-[1600px] mx-auto px-4 py-12 flex flex-col items-center">
        
        <!-- Header Section -->
        <!-- Added more margin-bottom (mb-24) to create ample space for Eagle Eye HUD -->
        <div class="text-center mb-24 md:mb-32 relative z-20">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-900/80 border border-slate-700 text-xs font-mono text-sky-400 mb-6 backdrop-blur-sm">
                <i data-lucide="activity" class="w-3 h-3 animate-pulse"></i>
                <span id="system-status">SYSTEM STATUS: OPTIMAL</span>
            </div>
            
            <h1 class="text-5xl md:text-7xl font-extrabold text-white tracking-tight mb-4 leading-tight">
                Monitor. Protect. <span class="text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-indigo-400">Optimize.</span>
            </h1>
            <p class="text-slate-400 max-w-2xl mx-auto text-lg font-light">
                The comprehensive digital twin ecosystem for modern construction.
            </p>
        </div>

        <!-- THE HOLOGRAPHIC STAGE -->
        <!-- Increased height to accommodate larger orbit -->
        <div id="stage-container" class="relative w-full h-[800px] md:h-[900px] flex items-center justify-center perspective-[1200px]">
            
            <!-- 1. Particle Globe Canvas -->
            <canvas id="globe-canvas" class="absolute z-10 w-[450px] h-[450px] pointer-events-none"></canvas>

            <!-- 2. SVG Network Layer (Lines) -->
            <svg id="network-svg" class="absolute inset-0 w-full h-full pointer-events-none z-0 overflow-visible">
                <!-- Lines injected by JS -->
            </svg>

            <!-- 3. Satellites Layer (Product Nodes) -->
            <div id="satellites-layer" class="absolute inset-0 pointer-events-none z-20">
                <!-- Satellites injected by JS -->
            </div>

        </div>
    </div>

    <!-- JS Logic -->
    <script>
        // --- Configuration & Data ---
        const MODULES = [
            { 
                id: 'eagle', 
                label: 'EAGLE EYE', 
                subLabel: 'Remote Monitor',
                color: 'sky', 
                icon: 'eye', 
                direction: 'top', // Expands TOP
                desc: "Real-time digital twin with IoT and 360Â° capture, enabling remote monitoring.", 
                statLabel: "Live Feeds",
                statValue: "12 Active" 
            },
            { 
                id: 'ssss', 
                label: 'SSSS', 
                subLabel: 'Site Safety',
                color: 'amber', 
                icon: 'shield', 
                direction: 'right', // Expands RIGHT
                desc: "AI-powered wearables & cameras for instant hazard alerts.", 
                statLabel: "Risk Level",
                statValue: "0%" 
            },
            { 
                id: 'dwss', 
                label: 'DWSS', 
                subLabel: 'Digital Works',
                color: 'slate', 
                icon: 'file-check', 
                direction: 'bottom', // Expands DOWN
                desc: "Secure portal for submission & approval with automated compliance.", 
                statLabel: "Pending",
                statValue: "3 Items" 
            },
            { 
                id: 'cdcp', 
                label: 'CDCP', 
                subLabel: 'Common Data',
                color: 'indigo', 
                icon: 'database', 
                direction: 'bottom', // Expands DOWN
                desc: "Unified BIM hub for seamless collaboration & version control.", 
                statLabel: "Data Sync",
                statValue: "8.4 PB" 
            },
            { 
                id: 'assets', 
                label: 'ASSETS', 
                subLabel: 'Facility Mgmt',
                color: 'emerald', 
                icon: 'leaf', 
                direction: 'left', // Expands LEFT
                desc: "Digital twins for predictive maintenance & ESG tracking.", 
                statLabel: "Health",
                statValue: "98.5%" 
            },
        ];

        const CONFIG = {
            orbitRadius: 420, // Radius
            mobileOrbitRadius: 220, // Mobile fallback
            autoRotateInterval: 5000,
            colors: {
                sky: '56, 189, 248',
                amber: '251, 191, 36',
                indigo: '129, 140, 248',
                slate: '148, 163, 184',
                emerald: '52, 211, 153'
            },
            colorRGB: {
                sky: '56, 189, 248',
                amber: '251, 191, 36',
                indigo: '129, 140, 248',
                slate: '148, 163, 184',
                emerald: '52, 211, 153'
            }
        };

        // State
        let state = {
            activeId: null,
            isHovering: false,
            width: 0,
            height: 0,
            center: { x: 0, y: 0 }
        };

        // DOM Elements
        const stage = document.getElementById('stage-container');
        const globeCanvas = document.getElementById('globe-canvas');
        const svgLayer = document.getElementById('network-svg');
        const satsLayer = document.getElementById('satellites-layer');

        // --- 1. Initialization ---
        function init() {
            lucide.createIcons();
            
            // Create Elements
            MODULES.forEach((mod, index) => createSatelliteNode(mod, index));
            
            handleResize();
            window.addEventListener('resize', handleResize);
            
            // Loops
            requestAnimationFrame(animateGlobe);
            startAutoCycle();
            
            // Interaction
            stage.addEventListener('mouseenter', () => {
                state.isHovering = true;
                stopAutoCycle();
            });
            stage.addEventListener('mouseleave', () => {
                state.isHovering = false;
                state.activeId = null;
                updateVisualState();
                startAutoCycle();
            });
        }

        function handleResize() {
            const rect = stage.getBoundingClientRect();
            state.width = rect.width;
            state.height = rect.height;
            state.center = { x: rect.width / 2, y: rect.height / 2 };
            updateVisualState();
        }

        // --- 2. Advanced Node Creation ---
        function createSatelliteNode(data, index) {
            const el = document.createElement('div');
            el.className = 'absolute pointer-events-auto flex flex-col items-center justify-center z-30';
            el.id = `node-${data.id}`;
            
            // Calculate positioning classes based on direction
            let contentPosClass = '';
            let originClass = '';
            
            // Decide where the HUD anchors relative to the icon
            if (data.direction === 'top') {
                contentPosClass = 'bottom-full mb-6 left-1/2 -translate-x-1/2'; 
                originClass = 'origin-bottom';
            } else if (data.direction === 'bottom') {
                contentPosClass = 'top-full mt-6 left-1/2 -translate-x-1/2';
                originClass = 'origin-top';
            } else if (data.direction === 'left') {
                contentPosClass = 'right-full mr-6 top-1/2 -translate-y-1/2';
                originClass = 'origin-right';
            } else if (data.direction === 'right') {
                contentPosClass = 'left-full ml-6 top-1/2 -translate-y-1/2';
                originClass = 'origin-left';
            }

            el.innerHTML = `
                <!-- Container for Icon + HUD -->
                <div class="relative flex flex-col items-center justify-center group">
                    
                    <!-- 1. Central Icon (Always Visible Anchor) -->
                    <button 
                        onclick="handleNodeClick('${data.id}')"
                        class="satellite-icon relative w-16 h-16 rounded-2xl bg-slate-900/90 border border-slate-700 flex items-center justify-center transition-all duration-300 hover:border-${data.color}-500 hover:scale-110 shadow-[0_0_20px_rgba(0,0,0,0.5)] z-50 group"
                    >
                        <i data-lucide="${data.icon}" class="w-8 h-8 text-${data.color}-400 group-hover:text-white transition-colors"></i>
                        
                        <!-- Mini Pulse Indicator (Idle) -->
                        <span class="absolute -top-1 -right-1 flex h-3 w-3">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-${data.color}-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-3 w-3 bg-${data.color}-500"></span>
                        </span>
                    </button>

                    <!-- 2. The Morphing HUD Container -->
                    <!-- In Idle state: Small pill (Slightly bigger now). Active: SUPER LARGE "Merged" Card -->
                    <div id="hud-${data.id}" 
                         class="hud-container absolute ${contentPosClass} ${originClass} transition-all duration-500 ease-out z-40 bg-slate-900/95 backdrop-blur-xl border border-slate-700 rounded-xl overflow-hidden shadow-2xl"
                         style="width: 160px; height: 56px;" 
                    >
                         <!-- IDLE CONTENT (Visible when inactive) -->
                         <div class="idle-content absolute inset-0 flex items-center justify-center transition-opacity duration-300 opacity-100 p-3 cursor-pointer" onclick="handleNodeClick('${data.id}')">
                            <div class="text-center leading-tight w-full">
                                <div class="text-xs font-black text-white tracking-widest uppercase mb-0.5">${data.label}</div>
                                <div class="text-[10px] text-slate-300 font-mono font-semibold">${data.subLabel}</div>
                            </div>
                         </div>

                         <!-- ACTIVE CONTENT (Merged Design) -->
                         <div class="active-content absolute inset-0 opacity-0 transition-opacity duration-300 pointer-events-none flex flex-col">
                             
                             <!-- Background Media Placeholder (Absolute) -->
                             <div class="absolute inset-0 z-0">
                                 <!-- Fake Image Pattern -->
                                 <div class="w-full h-full bg-slate-800 relative opacity-60">
                                     <div class="absolute inset-0" style="background-image: radial-gradient(circle, #fff 1px, transparent 1px); background-size: 20px 20px; opacity: 0.2"></div>
                                     <div class="absolute inset-0 flex items-center justify-center">
                                         <i data-lucide="image" class="w-16 h-16 text-slate-600 opacity-50"></i>
                                     </div>
                                 </div>
                                 <!-- Gradient Overlay for Readability -->
                                 <div class="absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-950/90 to-transparent"></div>
                             </div>

                             <!-- Content Overlay (Z-10) -->
                             <div class="relative z-10 p-6 flex flex-col h-full justify-end">
                                 <!-- Top Tags -->
                                 <div class="absolute top-5 left-5 flex gap-2">
                                     <span class="text-[10px] font-bold bg-red-500/20 text-red-400 border border-red-500/30 px-2 py-1 rounded flex items-center gap-1.5">
                                         <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span> LIVE
                                     </span>
                                     <span class="text-[10px] font-mono text-slate-400 border border-slate-700 px-2 py-1 rounded bg-black/60 backdrop-blur">
                                         ID: ${data.id.toUpperCase()}_001
                                     </span>
                                 </div>

                                 <!-- Main Text Info -->
                                 <div class="mb-4">
                                     <div class="flex items-center gap-3 mb-2">
                                         <div class="p-1.5 rounded bg-${data.color}-500/20">
                                             <i data-lucide="${data.icon}" class="w-5 h-5 text-${data.color}-400"></i>
                                         </div>
                                         <h3 class="text-2xl font-bold text-white tracking-wide">${data.label}</h3>
                                     </div>
                                     <p class="text-sm text-slate-300 leading-relaxed max-w-[95%] font-light">
                                         ${data.desc}
                                     </p>
                                 </div>

                                 <!-- Bottom Stats Row -->
                                 <div class="grid grid-cols-2 gap-4 pt-4 border-t border-white/10">
                                     <div class="flex flex-col">
                                         <span class="text-[10px] text-slate-500 uppercase font-mono tracking-wider">${data.statLabel}</span>
                                         <span class="text-lg font-bold text-${data.color}-400 font-mono">${data.statValue}</span>
                                     </div>
                                     <div class="flex flex-col border-l border-white/10 pl-4">
                                          <span class="text-[10px] text-slate-500 uppercase font-mono tracking-wider">System</span>
                                          <span class="text-lg font-bold text-emerald-400 font-mono">ONLINE</span>
                                     </div>
                                 </div>
                             </div>
                             
                             <!-- Scan Beam Overlay -->
                             <div class="scan-beam" style="animation-duration: 4s; top: 0;"></div>
                         </div>
                    </div>
                    
                </div>
            `;
            
            satsLayer.appendChild(el);
            // Re-run icons
            lucide.createIcons();
        }

        // --- 3. Layout & Visual Updates ---
        function updateVisualState() {
            // Check radius based on screen size
            const currentRadius = window.innerWidth < 768 ? CONFIG.mobileOrbitRadius : CONFIG.orbitRadius;

            MODULES.forEach((mod, i) => {
                const el = document.getElementById(`node-${mod.id}`);
                if (!el) return;

                // Circular positioning (Pentagon distribution)
                // -90deg puts the first item (Eagle Eye) at the very top
                const angle = (2 * Math.PI * i) / MODULES.length - Math.PI / 2;
                
                const x = state.center.x + Math.cos(angle) * currentRadius;
                const y = state.center.y + Math.sin(angle) * currentRadius;

                // Center element
                el.style.left = `${x}px`;
                el.style.top = `${y}px`;
                el.style.transform = `translate(-50%, -50%)`;

                // --- Handle Active vs Idle State ---
                const isActive = state.activeId === mod.id;
                const hud = el.querySelector(`#hud-${mod.id}`);
                const idleContent = hud.querySelector('.idle-content');
                const activeContent = hud.querySelector('.active-content');
                const iconBtn = el.querySelector('.satellite-icon');

                if (isActive) {
                    // EXPAND HUD (Even Larger)
                    hud.style.width = '480px'; // Much Wider
                    hud.style.height = '280px'; // Taller
                    hud.style.borderColor = `rgb(${CONFIG.colors[mod.color].split(',').join(' ')})`; // Active border color
                    hud.style.zIndex = 100;

                    // Switch Content
                    idleContent.style.opacity = '0';
                    idleContent.style.pointerEvents = 'none';
                    
                    activeContent.style.opacity = '1';
                    activeContent.style.pointerEvents = 'auto';

                    // Highlight Icon
                    iconBtn.style.borderColor = `rgb(${CONFIG.colors[mod.color].split(',').join(' ')})`;
                    iconBtn.style.boxShadow = `0 0 40px rgba(${CONFIG.colors[mod.color].split(',').join(' ')}, 0.5)`;
                    iconBtn.style.transform = 'scale(1.2)';

                } else {
                    // SHRINK HUD (Idle State - slightly bigger now)
                    hud.style.width = '160px';
                    hud.style.height = '56px';
                    hud.style.borderColor = ''; // Reset border
                    hud.style.zIndex = 40;

                    // Switch Content
                    idleContent.style.opacity = '1';
                    idleContent.style.pointerEvents = 'auto';
                    
                    activeContent.style.opacity = '0';
                    activeContent.style.pointerEvents = 'none';

                    // Reset Icon
                    iconBtn.style.borderColor = '';
                    iconBtn.style.boxShadow = '';
                    iconBtn.style.transform = '';
                }
            });

            // Ensure lines are redrawn
            updateConnections(currentRadius);
        }

        function handleNodeClick(id) {
            state.activeId = state.activeId === id ? null : id;
            updateVisualState();
        }

        // --- 4. Dynamic Mesh Network (Connections) ---
        function updateConnections(radius) {
            let svgHTML = `<defs>
                <filter id="glow-strong">
                    <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                    <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                </filter>
            </defs>`;

            // Helper to generate packet animation ID
            const getPacketId = (from, to) => `packet-${from}-${to}`;

            // 1. Draw Mesh Network (Pentagon) - Always visible but faint
            for (let i = 0; i < MODULES.length; i++) {
                const mod = MODULES[i];
                const nextMod = MODULES[(i + 1) % MODULES.length]; // Next in ring

                const angle = (2 * Math.PI * i) / MODULES.length - Math.PI / 2;
                const nextAngle = (2 * Math.PI * ((i + 1) % MODULES.length)) / MODULES.length - Math.PI / 2;

                const sx = state.center.x + Math.cos(angle) * radius;
                const sy = state.center.y + Math.sin(angle) * radius;
                
                const nx = state.center.x + Math.cos(nextAngle) * radius;
                const ny = state.center.y + Math.sin(nextAngle) * radius;

                // Mesh Line - BRIGHTER (opacity 0.5)
                svgHTML += `
                    <path 
                        d="M ${sx} ${sy} L ${nx} ${ny}" 
                        stroke="#475569" 
                        stroke-width="1.5" 
                        stroke-dasharray="6 6"
                        opacity="0.5"
                    />
                `;
                
                // Data Packet on Mesh Line (SLOWER DURATION)
                // Randomly offset duration for organic feel (increased from 4s to 8s)
                const dur = 8 + (i % 3);
                svgHTML += `
                    <circle r="2" fill="rgba(255,255,255,0.8)">
                        <animateMotion 
                            dur="${dur}s" 
                            repeatCount="indefinite"
                            path="M ${sx} ${sy} L ${nx} ${ny}"
                        />
                    </circle>
                `;
            }

            // 2. Draw Radial Lines (Earth to Node)
            MODULES.forEach((mod, i) => {
                const angle = (2 * Math.PI * i) / MODULES.length - Math.PI / 2;
                const isActive = state.activeId === mod.id;
                const colorRGB = CONFIG.colorRGB[mod.color];

                const sx = state.center.x + Math.cos(angle) * radius;
                const sy = state.center.y + Math.sin(angle) * radius;
                
                // Globe surface
                const globeR = 150; 
                const ex = state.center.x + Math.cos(angle) * globeR;
                const ey = state.center.y + Math.sin(angle) * globeR;

                if (isActive) {
                    // Define gradient for active beam
                    const gradientId = `grad-${mod.id}`;
                    svgHTML += `
                        <linearGradient id="${gradientId}" x1="${sx}" y1="${sy}" x2="${ex}" y2="${ey}" gradientUnits="userSpaceOnUse">
                            <stop offset="0%" stop-color="rgb(${colorRGB})" stop-opacity="1" />
                            <stop offset="100%" stop-color="rgb(${colorRGB})" stop-opacity="0" />
                        </linearGradient>
                    `;

                    // Active Beam
                    svgHTML += `
                        <path 
                            d="M ${sx} ${sy} L ${ex} ${ey}" 
                            stroke="url(#${gradientId})" 
                            stroke-width="4"
                            class="beam-glow"
                            stroke-linecap="round"
                        />
                        <circle cx="${ex}" cy="${ey}" r="4" fill="rgb(${colorRGB})" class="beam-glow" />
                        
                        <!-- Fast Data Packet on Active Beam -->
                        <circle r="3" fill="white" filter="url(#glow-strong)">
                             <animateMotion 
                                dur="1s" 
                                repeatCount="indefinite"
                                path="M ${sx} ${sy} L ${ex} ${ey}"
                            />
                        </circle>
                    `;
                } else {
                    // Idle Connector - BRIGHTER (opacity 0.5, width 1.5)
                    svgHTML += `
                        <path 
                            d="M ${ex} ${ey} L ${sx} ${sy}" 
                            stroke="#475569" 
                            stroke-width="1.5"
                            opacity="0.5"
                        />
                    `;
                    
                    // Slow Data Packet on Idle Beam (SLOWER DURATION)
                    // Increased from 3s to 6s
                    svgHTML += `
                        <circle r="2" fill="rgba(255,255,255,0.5)">
                            <animateMotion 
                                dur="6s" 
                                repeatCount="indefinite"
                                path="M ${sx} ${sy} L ${ex} ${ey}"
                            />
                        </circle>
                    `;
                }
            });
            svgLayer.innerHTML = svgHTML;
        }

        // --- 5. Auto Cycle Logic ---
        let cycleInterval;
        function startAutoCycle() {
            clearInterval(cycleInterval);
            cycleInterval = setInterval(() => {
                const currentIndex = MODULES.findIndex(m => m.id === state.activeId);
                const nextIndex = state.activeId ? (currentIndex + 1) % MODULES.length : 0;
                state.activeId = MODULES[nextIndex].id;
                updateVisualState();
            }, CONFIG.autoRotateInterval);
        }

        function stopAutoCycle() {
            clearInterval(cycleInterval);
        }

        // --- 6. Particle Globe Animation (3D Depth Boost) ---
        const ctx = globeCanvas.getContext('2d');
        let globeRotation = 0;

        function animateGlobe() {
            globeCanvas.width = 450;
            globeCanvas.height = 450;
            const w = globeCanvas.width;
            const h = globeCanvas.height;
            const r = 200; // Globe Radius

            ctx.clearRect(0, 0, w, h);

            // 1. Core Inner Glow (Bright Center)
            const innerGlow = ctx.createRadialGradient(w/2, h/2, 0, w/2, h/2, r * 0.8);
            innerGlow.addColorStop(0, 'rgba(56, 189, 248, 0.15)');
            innerGlow.addColorStop(1, 'rgba(0,0,0,0)');
            ctx.fillStyle = innerGlow;
            ctx.fillRect(0,0,w,h);

            // 2. Outer Atmospheric Glow
            const outerGlow = ctx.createRadialGradient(w/2, h/2, r * 0.8, w/2, h/2, r * 1.2);
            outerGlow.addColorStop(0, 'rgba(56, 189, 248, 0.05)');
            outerGlow.addColorStop(1, 'rgba(0,0,0,0)');
            ctx.fillStyle = outerGlow;
            ctx.fillRect(0,0,w,h);

            // Constant rotation
            globeRotation += 0.002;

            const DOT_COUNT = 1600;
            const dots = [];

            // Generate Dots positions
            for(let i=0; i<DOT_COUNT; i++) {
                const phi = Math.acos(-1 + (2 * i) / DOT_COUNT);
                const theta = Math.sqrt(DOT_COUNT * Math.PI) * phi;
                
                const x = r * Math.cos(theta) * Math.sin(phi);
                const y = r * Math.sin(theta) * Math.sin(phi);
                const z = r * Math.cos(phi);

                // Rotate Y
                const rx = x * Math.cos(globeRotation) - z * Math.sin(globeRotation);
                const rz = z * Math.cos(globeRotation) + x * Math.sin(globeRotation);

                const scale = 500 / (500 - rz);
                const x2d = rx * scale + w/2;
                const y2d = y * scale + h/2;

                dots.push({ x: x2d, y: y2d, z: rz, scale: scale });
            }

            // Sort dots by Z depth (painter's algorithm)
            dots.sort((a, b) => a.z - b.z);

            // Draw dots
            dots.forEach(dot => {
                const alpha = (dot.z + r) / (2 * r); // 0 at back, 1 at front
                
                ctx.beginPath();
                // Logic: Front dots are bright and big. Back dots are dim and small but VISIBLE.
                // Front (z > 0): High Opacity (0.8 - 1.0)
                // Back (z < 0): Low Opacity (0.1 - 0.3)
                
                let opacity = 0.1 + (alpha * 0.8); 
                let size = 1.5 * dot.scale;

                if (dot.z < 0) {
                    // Back side specifics
                    opacity = 0.15; 
                    size = 1.0 * dot.scale;
                    ctx.fillStyle = `rgba(56, 189, 248, ${opacity})`;
                } else {
                    // Front side specifics
                    ctx.fillStyle = `rgba(56, 189, 248, ${opacity})`;
                }

                ctx.arc(dot.x, dot.y, size, 0, Math.PI * 2);
                ctx.fill();
            });

            requestAnimationFrame(animateGlobe);
        }

        // Start
        init();

    </script>
</body>
</html>